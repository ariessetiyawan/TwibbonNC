(function(){"use strict";let d=null;window.onload=async t=>{chrome.storage.sync.get(["alertmsg","html","foto_nikah_i","foto_nikah_s"],function(i){chrome.storage.local.get(["foto_nikah_i","foto_nikah_s"],function(m){try{let n=window.location.search.split("?")[1],r=new URLSearchParams(n);for(let e of r.entries())e[0]=="do"&&(d=e[1])}catch{}var o=i.alertmsg;let s=document.getElementById("msg");if(o.includes('id="imgkartunikah"')){let a=document.getElementById("loader");a.style.display="block",chrome.storage.sync.get("imgkartunikah",function(n){setTimeout(()=>{let r=document.getElementById("imgkartunikah");var e=new Image;e.onload=function(){r.src=this.src,a.style.display="none"},r.src="http://localhost:5000/data/"+n.imgkartunikah,a.style.display="none"},1e3)})}else if(o.includes("photo_pa")&&o.includes("photo_pi"))document.getElementById("content").insertAdjacentHTML("afterbegin",o),setTimeout(()=>{document.getElementById("photo_pa").src=m.foto_nikah_s,document.getElementById("photo_pi").src=m.foto_nikah_i},500);else if(o.includes("twibbon")){let a=document.getElementById("content");chrome.storage.sync.get(["URL_EDITFOTO","tokencsrf","tokeneKUA","TWBMC_TMPLIMG","TWBMC_TMPLTXT","TWBMC_AKUNFB","URL_END_POINT_NB"],async function(n){var r=n.TWBMC_TMPLIMG;n.TWBMC_TMPLTXT,n.URL_END_POINT_NB;var e=n.tokeneKUA;n.tokencsrf,n.TWBMC_AKUNFB;var l="http://localhost:5000/templatenc/"+e,c={namasuami:"NAMA SUAMI",bin:"BIN NAMA AYAH SUAMI",namaistri:"NAMA ISTRI",binti:"BINTI NAMA AYAH ISTRI",kabko:"KEMENAG KABUPATEN/KOTA",kua:"KANTOR URUSAN AGAMA KECAMATAN",tanggal:"TANGGAL AKAD NIKAH",lokasi:"LOKASI AKAD NIKAH",template:r,photosuami:"",photoistri:"",rgb:[0,0,0]};await fetch(l,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(c),method:"POST",mode:"cors"}).then(u=>{if(u.ok)return u.text();throw new Error("Response was not ok.")}).then(async u=>{try{document.getElementById("content").innerText="Preview Template";var k=JSON.parse(u),A=k.data,w={},f=`<img src="data:image/png;base64,${A}" width="600px" id="twibbon"/>`;a.insertAdjacentHTML("afterbegin",f)}catch{}})})}s!==null&&(s.innerHTML=o)})})};const y=async()=>{chrome.windows.getCurrent(t=>{chrome.windows.remove(t.id)})};async function h(t,i,m){const o=t.replace(/^data:.+;base64,/,""),s=atob(o),a=new Array(s.length);for(let c=0;c<s.length;c++)a[c]=s.charCodeAt(c);const n=new Uint8Array(a),r=new Blob([n],{type:i}),e=URL.createObjectURL(r),l=document.createElement("a");l.href=e,l.download=m,l.click(),URL.revokeObjectURL(e)}const g=async()=>{chrome.storage.local.get(["foto_nikah_i","foto_nikah_s"],async function(t){await h(t.foto_nikah_s,"image/jpeg","suami_photo.jpg"),await h(t.foto_nikah_i,"image/jpeg","istri_photo.jpg")})},p=async()=>{try{if(d==null)chrome.windows.getCurrent(t=>{chrome.windows.remove(t.id)});else if(d=="loadImage"){let t=document.getElementById("loader");t.style.display="block",setTimeout(()=>{t.style.display="none"},3e3)}else if(d=="update"){let t=document.getElementById("loader");t.style.display="block",chrome.storage.sync.get(["username","kuaname","tokeneKUA","userID"],async function(i){var m="https://script.google.com/macros/s/AKfycbzw5Uheulz4HbcIdgz6q4z4yakP_Ta05rKd3TnWvQ9DfajQ8uuCYybHjwM1uAweb6A7-w/exec",o={};o.aksi=3,o.userID=i.userID,o.kuaname=i.kuaname,o.username=i.username;var s=i.tokeneKUA,a=await fetch(m,{body:JSON.stringify(o),method:"POST",contentType:"application/json"}).then(e=>{if(e.ok)return e.text();throw new Error("Response was not ok.")}).then(async e=>e).catch(e=>{console.log(e)}),n=JSON.parse(a);let r=await fetch("http://localhost:5000/updextg4/"+s+"/"+n.data,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({filename:n.data}),method:"POST",mode:"cors"}).then(e=>{if(e.ok)return e.text();throw new Error("Response was not ok.")}).then(e=>{console.log(e),chrome.runtime.reload(),t.style.display="hide";var l=JSON.parse(e);return l.success&&chrome.windows.getCurrent(c=>{chrome.windows.remove(c.id)}),e})})}}catch{window.close()}};try{document.getElementById("myButton").addEventListener("click",p)}catch{}try{const t=document.getElementById("myunduh");t!==null&&t.addEventListener("click",g)}catch{}try{document.getElementById("btnkeluar").addEventListener("click",y)}catch{}})();
